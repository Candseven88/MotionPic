# Vercel 部署修复说明

## 问题描述

在 Vercel 部署环境中，应用遇到了以下错误：
```
EROFS: read-only file system, open '/var/task/public/generated/image_1751270253024.png'
```

这是因为 Vercel 的无服务器环境使用只读文件系统，无法写入文件到本地文件系统。

## 解决方案

### 1. 图片生成 API (`/api/generate-image`)

**修改前：**
- 使用 `FileStorageService` 将生成的图片保存到本地文件系统
- 返回本地文件路径

**修改后：**
- 直接返回远程图片 URL
- 移除本地文件保存逻辑
- 不再依赖 `FileStorageService`

### 2. 视频生成 API (`/api/generate-video`)

**修改前：**
- 使用 `FileStorageService` 将生成的视频和封面图片保存到本地文件系统
- 返回本地文件路径

**修改后：**
- 直接返回远程视频和封面图片 URL
- 移除本地文件保存逻辑
- 不再依赖 `FileStorageService`

### 3. 历史记录 API (`/api/history`)

**修改前：**
- 从本地文件系统读取生成的文件历史
- 支持删除本地文件

**修改后：**
- 返回空的历史记录
- 显示提示信息说明功能暂时不可用
- 删除功能暂时禁用

### 4. 上传 API (`/api/upload`)

**修改前：**
- 将上传的文件保存到本地文件系统
- 返回本地文件路径

**修改后：**
- 返回错误信息说明功能暂时不可用
- 由于环境限制，上传功能暂时禁用

### 5. 前端组件修改

**ImageGenerator.tsx：**
- 修复了对 `originalUrl` 字段的依赖
- 直接使用 `imageUrl` 作为视频生成的输入

**History.tsx：**
- 显示提示信息说明历史记录功能暂时不可用
- 移除了文件管理相关的UI

## 影响和限制

### 功能影响
1. **历史记录功能**：暂时不可用
2. **文件上传功能**：暂时不可用
3. **本地文件管理**：不可用

### 仍然可用的功能
1. **图片生成**：正常工作，直接使用远程URL
2. **视频生成**：正常工作，直接使用远程URL
3. **文件下载**：通过远程URL直接下载

## 未来改进建议

### 短期方案
1. 使用云存储服务（如 AWS S3、Cloudinary）来存储生成的文件
2. 实现数据库来跟踪生成历史
3. 重新启用上传功能，使用云存储

### 长期方案
1. 实现完整的云存储集成
2. 添加用户文件管理功能
3. 实现文件分享和协作功能

## 部署验证

修改后的代码已经通过构建测试，所有API端点都能正常工作：
- ✅ 图片生成 API
- ✅ 视频生成 API  
- ✅ 历史记录 API（返回空记录）
- ✅ 上传 API（返回服务不可用）

## 注意事项

1. 生成的文件现在直接使用远程URL，可能有时效性限制
2. 用户需要及时下载生成的文件，因为无法通过历史记录重新访问
3. 建议在UI中添加提示，告知用户及时下载文件 